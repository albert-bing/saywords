$(function() {
	validateRule()
});
layui.use(["element", "layer"], function() {
	var b = layui.element;
	var a = layui.layer;
	var c = layui.jquery()
});

function check_infomation() {}
$.validator.setDefaults({
	submitHandler: function() {
		logon()
	}
});
var pdata;

function logon() {
	var b = $("input[name='username']").val().trim();
	var a = $("input[name='password']").val().trim();
	$.ajax({
		type: "post",
		url: "http://localhost:9999/partone/logon",
		data: {
			username: b,
			password: a
		},
		success: function(c) {
			if(c.code == 0) {
				$.ajax({
					type: "post",
					url: "http://localhost:9999/partone/getSchool",
					success: function(d) {
						pdata = d;
						console.log(d);
						check_infomation(pdata)
					}
				})
			} else {
				$("#content").html("用户名或密码错误");
				$("#alert").modal()
			}
		},
		error: function(c) {
			$("#content").html("服务器无响应");
			$("#alert").modal()
		}
	})
}

function check_infomation(a) {
	layer.open({
		type: 1,
		offset: "auto",
		id: "layer" + 1,
		title: '<p style="font-size:18px;font-weight:500;margin-left:148px;">请确认您的信息</p>',
		content: '<div style="padding: 20px 100px;"><div style="width:230px;height:25px;"><label>学校:</label><input type="text" value="' + a[0].schoolname + '" style="float:right;" readonly="true"></div><br><div style="width:230px;height:25px;"><label>学籍号:</label><input type="text" value="' + a[0].studentNO + '" style="float:right;" readonly="true"></div><br><div style="width:230px;height:25px;"><label>姓名:</label><input type="text" value="' + a[0].name + '" style="float:right;" readonly="true"></div><br><div style="width:230px;height:25px;"><label>性别:</label><input type="text" value="' + a[0].gender + '" style="float:right;" readonly="true"></div><br><div style="width:230px;height:25px;"><label>年级:</label><input type="text" value="' + a[0].grade + '" style="float:right;" readonly="true"></div><br><div style="width:230px;height:25px;"><label>班级:</label><input type="text" value="' + a[0].clsname + '" style="float:right;" readonly="true"></div><br><div style="width:230px;height:25px;"><label>出生日期:</label><input type="text" value="' + a[0].birthday + '" style="float:right;" readonly="true"></div></div>',
		btn: ["确定"],
		btnAlign: "c",
		shade: 0.5,
		area: ["425px", "430px"],
		yes: function() {
			/*if(a[0].part == "40") {
				location.href = "/partfour/sendPBIntro3";
				layer.closeAll()
			} else {
				location.href = "/partone/sendPBIntro";
				layer.closeAll()
			}*/
			if(pdata[0].part == '1') {
				location.href = '/partone/sendPBIntro';
				layer.closeAll();
			} else if(pdata[0].part == '40') {
				alert(pdata[0].part)
				location.href = '/partfour/sendPBIntro3';
				layer.closeAll();
			} else {
				location.href = '/partthree/sendPBIntro2';
				layer.closeAll();
			}
		}
	})
}

function validateRule() {
	$("#logonForm").validate({
		rules: {
			username: {
				required: true
			},
			password: {
				required: true
			}
		},
		messages: {
			username: {
				required: "请输入您的用户名"
			},
			password: {
				required: "请输入您的密码"
			}
		}
	})
};